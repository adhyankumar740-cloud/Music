<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Purpleify - Safe & Secure</title>
    <style>
        :root { --bg: #0a0510; --card: #1a0b2e; --purple: #9d50bb; --text: #e0e0e0; }
        body { background: var(--bg); color: var(--text); font-family: 'Segoe UI'; margin: 0; display: flex; height: 100vh; }
        .sidebar { width: 250px; background: #000; padding: 20px; border-right: 1px solid #222; }
        .main { flex: 1; padding: 20px; overflow-y: auto; background: linear-gradient(180deg, #2d1b4e 0%, #0a0510 40%); }
        .search-box { display: flex; gap: 10px; margin-bottom: 30px; }
        input { flex: 1; padding: 12px; border-radius: 25px; border: none; background: #1a1a1a; color: white; outline: none; }
        button { padding: 10px 20px; border-radius: 25px; border: none; background: var(--purple); color: white; cursor: pointer; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 20px; padding-bottom: 100px; }
        .card { background: var(--card); padding: 15px; border-radius: 12px; text-align: center; }
        .card img { width: 100%; border-radius: 8px; }
        .player-bar { position: fixed; bottom: 0; width: 100%; height: 90px; background: #121212; display: flex; align-items: center; padding: 0 20px; box-sizing: border-box; justify-content: space-between; border-top: 2px solid var(--purple); }
    </style>
</head>
<body>

    <div class="sidebar">
        <h2>Purpleify üéß</h2>
        <p onclick="loadPlaylist()" style="cursor:pointer">‚≠ê My Library</p>
        <p onclick="location.reload()" style="cursor:pointer">üîç Search</p>
    </div>

    <div class="main">
        <div class="search-box">
            <input type="text" id="query" placeholder="Search music...">
            <button onclick="search()">Search</button>
        </div>
        <div class="grid" id="display"></div>
    </div>

    <div class="player-bar">
        <div id="playing-info">Ready to Play</div>
        <div id="player-container"></div>
    </div>

    <script>
        let YT_KEY = "";

        // Server se variables load karna
        async function loadConfig() {
            const res = await fetch('/api/config');
            const data = await res.json();
            YT_KEY = data.yt_key;
        }
        loadConfig();

        async function search() {
            if(!YT_KEY) return alert("System loading, wait...");
            const q = document.getElementById('query').value;
            const res = await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&q=${q}&type=video&maxResults=12&key=${YT_KEY}`);
            const data = await res.json();
            showSongs(data.items, true);
        }

        function showSongs(songs, isSearch) {
            const div = document.getElementById('display');
            div.innerHTML = '';
            songs.forEach(s => {
                const videoId = isSearch ? s.id.videoId : s.videoId;
                const title = (isSearch ? s.snippet.title : s.title).replace(/'/g,"");
                const img = isSearch ? s.snippet.thumbnails.medium.url : s.thumbnail;

                div.innerHTML += `
                    <div class="card">
                        <img src="${img}">
                        <p style="font-size:12px;">${title.slice(0,35)}...</p>
                        <button onclick="play('${videoId}', '${title}')">Play</button>
                        ${isSearch ? `<button onclick="save('${videoId}', '${title}', '${img}')">‚ù§Ô∏è</button>` : ''}
                    </div>`;
            });
        }

        async function save(id, title, img) {
            await fetch('/api/playlist', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ videoId: id, title: title, thumbnail: img })
            });
            alert("Added to Playlist!");
        }

        async function loadPlaylist() {
            const res = await fetch('/api/playlist');
            const data = await res.json();
            showSongs(data, false);
        }

        function play(id, title) {
            document.getElementById('playing-info').innerText = "Playing: " + title;
            document.getElementById('player-container').innerHTML = 
                `<iframe width="150" height="70" src="https://www.youtube.com/embed/${id}?autoplay=1" frameborder="0" allow="autoplay"></iframe>`;
        }
    </script>
</body>
</html>
