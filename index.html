<!DOCTYPE html>
<html lang="en">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
Â  Â  <title>Pixel Music Elite - Premium Sync</title>
Â  Â  <script src="https://accounts.google.com/gsi/client" async defer></script>
Â  Â  <script src="https://www.youtube.com/iframe_api"></script>
Â  Â  <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
Â  Â  <script src="https://unpkg.com/lucide@latest"></script>
Â  Â  <style>
Â  Â  Â  Â  :root {Â 
Â  Â  Â  Â  Â  Â  --ios-pink: #ff2d55;Â 
Â  Â  Â  Â  Â  Â  --glow: rgba(255, 45, 85, 0.4);Â 
Â  Â  Â  Â  Â  Â  --glass: rgba(255, 255, 255, 0.08);Â 
Â  Â  Â  Â  Â  Â  --border: rgba(255, 255, 255, 0.15);
Â  Â  Â  Â  Â  Â  --bg-deep: #050505;
Â  Â  Â  Â  }

Â  Â  Â  Â  * { box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  body {Â 
Â  Â  Â  Â  Â  Â  margin: 0; background: var(--bg-deep); color: #fff;Â 
Â  Â  Â  Â  Â  Â  font-family: -apple-system, system-ui, sans-serif;Â 
Â  Â  Â  Â  Â  Â  overflow: hidden; height: 100dvh;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* Animated Visual Background */
Â  Â  Â  Â  .visual-bg {
Â  Â  Â  Â  Â  Â  position: fixed; inset: 0; z-index: -1;
Â  Â  Â  Â  Â  Â  background: radial-gradient(circle at center, #111 0%, #000 100%);
Â  Â  Â  Â  }
Â  Â  Â  Â  .neon-ring {
Â  Â  Â  Â  Â  Â  position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
Â  Â  Â  Â  Â  Â  width: 300px; height: 300px; border: 2px solid var(--ios-pink);
Â  Â  Â  Â  Â  Â  border-radius: 50%; opacity: 0; filter: blur(20px);
Â  Â  Â  Â  Â  Â  transition: 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
Â  Â  Â  Â  }
Â  Â  Â  Â  .playing .neon-ring { opacity: 0.3; width: 450px; height: 450px; animation: pulse 2s infinite alternate; }
Â  Â  Â  Â  @keyframes pulse { from { transform: translate(-50%, -50%) scale(1); opacity: 0.2; } to { transform: translate(-50%, -50%) scale(1.1); opacity: 0.4; } }

Â  Â  Â  Â  /* Login Screen Enhancements */
Â  Â  Â  Â  #auth-screen {Â 
Â  Â  Â  Â  Â  Â  position: fixed; inset: 0; background: #000; z-index: 20000;Â 
Â  Â  Â  Â  Â  Â  display: flex; flex-direction: column; align-items: center; justify-content: center;
Â  Â  Â  Â  Â  Â  background-image: linear-gradient(rgba(255,45,85,0.05) 1px, transparent 1px), linear-gradient(90deg, rgba(255,45,85,0.05) 1px, transparent 1px);
Â  Â  Â  Â  Â  Â  background-size: 30px 30px;
Â  Â  Â  Â  }

Â  Â  Â  Â  .login-box {
Â  Â  Â  Â  Â  Â  width: 85%; max-width: 400px; padding: 40px; text-align: center;
Â  Â  Â  Â  Â  Â  background: rgba(15, 15, 15, 0.8); backdrop-filter: blur(30px);
Â  Â  Â  Â  Â  Â  border-radius: 40px; border: 1px solid var(--border);
Â  Â  Â  Â  Â  Â  box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
Â  Â  Â  Â  }

Â  Â  Â  Â  .btn-mega {Â 
Â  Â  Â  Â  Â  Â  background: var(--glass); backdrop-filter: blur(25px); border: 1px solid var(--border);Â 
Â  Â  Â  Â  Â  Â  border-radius: 20px; color: white; display: flex; align-items: center; justify-content: center;Â 
Â  Â  Â  Â  Â  Â  cursor: pointer; transition: 0.3s; font-weight: 600; text-decoration: none;
Â  Â  Â  Â  }
Â  Â  Â  Â  .btn-mega:active { transform: scale(0.95); background: var(--ios-pink); }

Â  Â  Â  Â  /* View Management */
Â  Â  Â  Â  .view { display: none; height: 100dvh; overflow-y: auto; padding: 130px 25px 220px; }
Â  Â  Â  Â  .view.active { display: block; animation: slideUp 0.6s cubic-bezier(0.23, 1, 0.32, 1); }
Â  Â  Â  Â  @keyframes slideUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }

Â  Â  Â  Â  /* List Styling */
Â  Â  Â  Â  .song-card {Â 
Â  Â  Â  Â  Â  Â  display: flex; align-items: center; background: rgba(255,255,255,0.03);Â 
Â  Â  Â  Â  Â  Â  padding: 15px; border-radius: 25px; margin-bottom: 12px;Â 
Â  Â  Â  Â  Â  Â  border: 1px solid transparent; transition: 0.3s;
Â  Â  Â  Â  }
Â  Â  Â  Â  .song-card:active { background: rgba(255,255,255,0.1); }
Â  Â  Â  Â  .song-card img { width: 60px; height: 60px; border-radius: 15px; margin-right: 18px; object-fit: cover; }

Â  Â  Â  Â  header {Â 
Â  Â  Â  Â  Â  Â  position: fixed; top: 0; width: 100%; padding: 60px 25px 20px;Â 
Â  Â  Â  Â  Â  Â  display: none; justify-content: space-between; align-items: center;Â 
Â  Â  Â  Â  Â  Â  z-index: 10000; background: linear-gradient(to bottom, #000, transparent);
Â  Â  Â  Â  }

Â  Â  Â  Â  #player-overlay {Â 
Â  Â  Â  Â  Â  Â  position: fixed; inset: 0; background: #000; z-index: 15000;Â 
Â  Â  Â  Â  Â  Â  transform: translateY(100%); transition: 0.7s cubic-bezier(0.9, 0, 0.1, 1);Â 
Â  Â  Â  Â  Â  Â  padding: 60px 30px; display: flex; flex-direction: column; align-items: center;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â  #player-overlay.active { transform: translateY(0); }

Â  Â  Â  Â  /* Custom Slider */
Â  Â  Â  Â  .slider {Â 
Â  Â  Â  Â  Â  Â  -webkit-appearance: none; width: 100%; height: 6px; background: #222;Â 
Â  Â  Â  Â  Â  Â  border-radius: 10px; margin: 35px 0; accent-color: var(--ios-pink);
Â  Â  Â  Â  }
Â  Â  Â  Â  .slider::-webkit-slider-thumb { -webkit-appearance: none; height: 18px; width: 18px; border-radius: 50%; background: #fff; box-shadow: 0 0 15px var(--ios-pink); }

Â  Â  Â  Â  .nav-dock {Â 
Â  Â  Â  Â  Â  Â  position: fixed; bottom: 30px; left: 20px; right: 20px; height: 85px;Â 
Â  Â  Â  Â  Â  Â  background: rgba(15, 15, 15, 0.8); backdrop-filter: blur(40px);Â 
Â  Â  Â  Â  Â  Â  border-radius: 35px; display: flex; justify-content: space-around;Â 
Â  Â  Â  Â  Â  Â  align-items: center; border: 1px solid var(--border); z-index: 9000;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â  .nav-link { color: #555; text-align: center; font-size: 10px; transition: 0.3s; cursor: pointer; }
Â  Â  Â  Â  .nav-link.active { color: #fff; transform: translateY(-5px); }

Â  Â  Â  Â  #profile-menu {
Â  Â  Â  Â  Â  Â  position: absolute; top: 120px; right: 25px; background: rgba(20, 20, 20, 0.98);
Â  Â  Â  Â  Â  Â  border: 1px solid var(--border); border-radius: 25px; padding: 12px;
Â  Â  Â  Â  Â  Â  display: none; flex-direction: column; width: 180px; z-index: 11000;
Â  Â  Â  Â  }

Â  Â  Â  Â  #mini-player {Â 
Â  Â  Â  Â  Â  Â  position: fixed; bottom: 125px; left: 20px; right: 20px; height: 80px;Â 
Â  Â  Â  Â  Â  Â  background: rgba(20,20,20,0.9); backdrop-filter: blur(30px);Â 
Â  Â  Â  Â  Â  Â  border-radius: 25px; display: none; align-items: center; padding: 0 15px;Â 
Â  Â  Â  Â  Â  Â  border: 1px solid var(--border); z-index: 9500;
Â  Â  Â  Â  }

Â  Â  Â  Â  .jam-user-badge {
Â  Â  Â  Â  Â  Â  background: var(--glass); padding: 5px 12px; border-radius: 15px; font-size: 11px;
Â  Â  Â  Â  Â  Â  display: flex; align-items: center; gap: 6px; border: 1px solid var(--border);
Â  Â  Â  Â  }

Â  Â  Â  Â  /* Visualizer Bars */
Â  Â  Â  Â  .visualizer-container { display: flex; gap: 4px; height: 20px; align-items: flex-end; margin-top: 10px; }
Â  Â  Â  Â  .v-bar { width: 4px; height: 4px; background: var(--ios-pink); border-radius: 2px; transition: 0.2s; }
Â  Â  Â  Â  .playing .v-bar { animation: bar-dance 0.8s infinite ease-in-out; }
Â  Â  Â  Â  @keyframes bar-dance { 0%, 100% { height: 4px; } 50% { height: 20px; } }

Â  Â  Â  Â  /* --- ADDED: LYRICS STYLE --- */
Â  Â  Â  Â  #lyrics-container {
Â  Â  Â  Â  Â  Â  position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 16000;
Â  Â  Â  Â  Â  Â  display: none; flex-direction: column; align-items: center; padding: 80px 30px;
Â  Â  Â  Â  Â  Â  overflow-y: auto; text-align: center;
Â  Â  Â  Â  }
Â  Â  Â  Â  .lyric-line { font-size: 24px; font-weight: 700; margin: 20px 0; opacity: 0.3; transition: 0.4s; }
Â  Â  Â  Â  .lyric-line.active { opacity: 1; color: var(--ios-pink); transform: scale(1.1); }
Â  Â  </style>
</head>
<body id="body-main">

<div id="toast" style="position: fixed; top: 70px; left: 50%; transform: translateX(-50%); background: var(--ios-pink); padding: 12px 25px; border-radius: 50px; z-index: 30000; display: none; font-weight: bold; box-shadow: 0 10px 20px var(--glow);"></div>

<div class="visual-bg"><div class="neon-ring"></div></div>

<div id="auth-screen">
Â  Â  <div class="login-box">
Â  Â  Â  Â  <h1 style="font-size: 55px; margin: 0; color: #fff;">Pixel<span style="color:var(--ios-pink)">.</span></h1>
Â  Â  Â  Â  <p style="opacity: 0.4; letter-spacing: 2px; font-weight: bold; margin-bottom: 35px;">AUTHENTICATION REQUIRED</p>
Â  Â  Â  Â Â 
Â  Â  Â  Â  <div id="g_id_onload" data-client_id="YOUR_GOOGLE_CLIENT_ID" data-callback="handleCredentialResponse"></div>
Â  Â  Â  Â  <div class="g_id_signin" data-type="standard" data-shape="pill" data-theme="filled_black" style="margin-bottom:15px; display:flex; justify-content:center;"></div>

Â  Â  Â  Â  <button class="btn-mega" style="width: 100%; height: 60px; background: var(--glass);" onclick="guestLogin()">
Â  Â  Â  Â  Â  Â  <i data-lucide="user" style="margin-right:10px"></i> GUEST ACCESS
Â  Â  Â  Â  </button>
Â  Â  </div>
</div>

<header id="main-header">
Â  Â  <div>
Â  Â  Â  Â  <h2 style="margin:0; font-size: 24px; font-weight: 900;">Pixel<span style="color:var(--ios-pink)">.</span></h2>
Â  Â  Â  Â  <small id="room-id-tag" style="color:var(--ios-pink); font-weight:bold;"></small>
Â  Â  </div>
Â  Â  <div id="user-avatar" onclick="toggleProfileMenu()" style="cursor:pointer; border: 2px solid var(--ios-pink); border-radius: 50%; width: 45px; height: 45px; overflow: hidden; background: #222;"></div>
</header>

<div id="profile-menu">
Â  Â  <button class="btn-mega" style="height:50px; border:none; background:transparent; justify-content: flex-start;" onclick="logout()">
Â  Â  Â  Â  <i data-lucide="log-out" style="margin-right:12px; color:var(--ios-pink)"></i> Logout
Â  Â  </button>
Â  Â  <button class="btn-mega" style="height:50px; border:none; background:transparent; justify-content: flex-start;" onclick="clearStorage()">
Â  Â  Â  Â  <i data-lucide="trash-2" style="margin-right:12px"></i> Wipe Data
Â  Â  </button>
</div>

<div id="home-view" class="view">
Â  Â  <div id="jam-info" style="background: var(--glass); border: 1px solid var(--ios-pink); padding: 20px; border-radius: 30px; margin-bottom: 30px; display: none;">
Â  Â  Â  Â  <div style="display:flex; justify-content:space-between; align-items:center;">
Â  Â  Â  Â  Â  Â  <b id="active-room-text">ROOM: --</b>
Â  Â  Â  Â  Â  Â  <button id="jam-action-btn" class="btn-mega" style="height:35px; padding:0 15px; background:#fff; color:#000; border-radius:10px;">LEAVE</button>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div id="jam-users-list" style="margin-top:15px; display:flex; gap:8px; flex-wrap:wrap;"></div>
Â  Â  </div>

Â  Â  <div id="jam-setup" style="display:flex; gap:12px; margin-bottom:35px;">
Â  Â  Â  Â  <button class="btn-mega" style="flex:1; height:65px;" onclick="createJam()"><i data-lucide="radio" style="margin-right:8px"></i> CREATE</button>
Â  Â  Â  Â  <button class="btn-mega" style="flex:1; height:65px;" onclick="joinJam()"><i data-lucide="users" style="margin-right:8px"></i> JOIN</button>
Â  Â  </div>

Â  Â  <h3 style="font-size: 22px; margin-bottom: 20px;"><i data-lucide="flame" style="color:var(--ios-pink); vertical-align:middle; margin-right:8px"></i>Trending Elite</h3>
Â  Â  <div id="home-feed"></div>
</div>

<div id="search-view" class="view">
Â  Â  <div style="position:relative; margin-bottom: 25px;">
Â  Â  Â  Â  <i data-lucide="search" style="position:absolute; left:20px; top:22px; color:#666;"></i>
Â  Â  Â  Â  <input id="sq" style="width:100%; height:65px; background:var(--glass); border:1px solid var(--border); border-radius:22px; padding:0 20px 0 55px; color:#fff; font-size:18px;" placeholder="Search Music..." onkeyup="if(event.key==='Enter') startSearch()">
Â  Â  </div>
Â  Â  <div id="search-results"></div>
</div>

<div id="library-view" class="view">
Â  Â  <h3 style="font-size: 28px; margin-bottom: 25px;">Collected Elite</h3>
Â  Â  <div id="library-list"></div>
</div>

<div id="settings-view" class="view">
Â  Â  <h3 style="font-size: 28px; margin-bottom: 25px;">Settings</h3>
Â  Â  <div class="song-card" style="justify-content: space-between;">
Â  Â  Â  Â  <b>Haptic Feedback</b>
Â  Â  Â  Â  <input type="checkbox" checked>
Â  Â  </div>
Â  Â  <div class="song-card" style="justify-content: space-between;">
Â  Â  Â  Â  <b>High Quality Audio</b>
Â  Â  Â  Â  <input type="checkbox" checked>
Â  Â  </div>
Â  Â  <div class="song-card" style="justify-content: space-between;" onclick="showToast('Visualizer Reset!')">
Â  Â  Â  Â  <b>Reset Visualizer</b>
Â  Â  Â  Â  <i data-lucide="refresh-cw"></i>
Â  Â  </div>
</div>

<div id="mini-player" onclick="togglePlayer(true)">
Â  Â  <img id="m-img" src="" style="width:55px; height:55px; border-radius:15px; margin-right:15px;">
Â  Â  <div style="flex:1; overflow:hidden;">
Â  Â  Â  Â  <b id="m-title" style="white-space:nowrap; font-size:15px;">...</b>
Â  Â  Â  Â  <div class="visualizer-container">
Â  Â  Â  Â  Â  Â  <div class="v-bar" style="animation-delay: 0s"></div>
Â  Â  Â  Â  Â  Â  <div class="v-bar" style="animation-delay: 0.2s"></div>
Â  Â  Â  Â  Â  Â  <div class="v-bar" style="animation-delay: 0.1s"></div>
Â  Â  Â  Â  </div>
Â  Â  </div>
Â  Â  <button class="btn-mega" style="width:55px; height:55px; border-radius:50%;" onclick="event.stopPropagation(); togglePlay();">
Â  Â  Â  Â  <i data-lucide="play" id="m-p-icon"></i>
Â  Â  </button>
</div>

<div id="player-overlay">
Â  Â  <div style="width: 100%; display: flex; justify-content: space-between; align-items: center;">
Â  Â  Â  Â  <button class="btn-mega" style="width:55px; height:55px;" onclick="togglePlayer(false)"><i data-lucide="chevron-down"></i></button>
Â  Â  Â  Â  <button class="btn-mega" style="width:55px; height:55px;" onclick="toggleLyrics(true)"><i data-lucide="align-left"></i></button>
Â  Â  </div>
Â  Â Â 
Â  Â  <div style="position:relative; margin: 40px 0;">
Â  Â  Â  Â  <div class="neon-ring" style="opacity:0.2; width:380px; height:380px;"></div>
Â  Â  Â  Â  <img id="f-img" src="" style="width: 85vw; height: 85vw; max-width:340px; border-radius: 40px; position:relative; z-index:2; box-shadow: 0 30px 60px rgba(0,0,0,0.8);">
Â  Â  </div>

Â  Â  <div style="width:100%; display:flex; justify-content:space-between; align-items:center;">
Â  Â  Â  Â  <div style="flex:1; overflow:hidden;">
Â  Â  Â  Â  Â  Â  <h2 id="f-title" style="margin:0; font-size:26px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Song</h2>
Â  Â  Â  Â  Â  Â  <p id="f-artist" style="opacity:0.5; margin:8px 0; font-size: 18px;">Artist</p>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div onclick="toggleFavorite()" style="cursor:pointer; padding:10px;"><i data-lucide="heart" id="fav-icon-heart" size="32"></i></div>
Â  Â  </div>

Â  Â  <input type="range" id="seek-slider" class="slider" value="0" onchange="seekSong(this.value)">

Â  Â  <div style="display:flex; justify-content:space-between; align-items:center; width:100%; margin-top:20px;">
Â  Â  Â  Â  <button class="btn-mega" style="width:75px; height:75px;" onclick="playPrev()"><i data-lucide="skip-back"></i></button>
Â  Â  Â  Â  <button class="btn-mega" style="width:100px; height:100px; border-radius:50%; background:#fff; color:#000;" onclick="togglePlay()">
Â  Â  Â  Â  Â  Â  <i data-lucide="play" id="p-icon" size="36"></i>
Â  Â  Â  Â  </button>
Â  Â  Â  Â  <button class="btn-mega" style="width:75px; height:75px;" onclick="playNext()"><i data-lucide="skip-forward"></i></button>
Â  Â  </div>
</div>

<div id="lyrics-container">
Â  Â  <button class="btn-mega" style="position:absolute; top:40px; right:30px; width:50px; height:50px;" onclick="toggleLyrics(false)"><i data-lucide="x"></i></button>
Â  Â  <div id="lyrics-content">
Â  Â  Â  Â  <p class="lyric-line active">Fetching Elite Lyrics...</p>
Â  Â  Â  Â  <p class="lyric-line">Enjoy the sync.</p>
Â  Â  </div>
</div>

<nav class="nav-dock" id="bottom-nav" style="display:none;">
Â  Â  <div class="nav-link active" onclick="switchTab('home', this)"><i data-lucide="home"></i><br><b>HOME</b></div>
Â  Â  <div class="nav-link" onclick="switchTab('search', this)"><i data-lucide="search"></i><br><b>SEARCH</b></div>
Â  Â  <div class="nav-link" onclick="switchTab('library', this)"><i data-lucide="music"></i><br><b>LIBRARY</b></div>
Â  Â  <div class="nav-link" onclick="switchTab('settings', this)"><i data-lucide="settings"></i><br><b>SETTINGS</b></div>
</nav>

<div id="yt-engine" style="position:fixed; left:-9999px;"><div id="player"></div></div>

<script>
Â  Â  let yt, apiKey, currentUser = null, playlist = [], favorites = [], currentIndex = 0;
Â  Â  let jamRoom = null, isAdmin = false;
Â  Â  const socket = (typeof io !== 'undefined') ? io() : { emit: ()=>{}, on: ()=>{} }; // Safety for no socket

Â  Â  function onYouTubeIframeAPIReady() {
Â  Â  Â  Â  yt = new YT.Player('player', { height: '0', width: '0', events: {Â 
Â  Â  Â  Â  Â  Â  'onStateChange': e => {
Â  Â  Â  Â  Â  Â  Â  Â  const isPlaying = (e.data === 1);
Â  Â  Â  Â  Â  Â  Â  Â  updatePlayIcons(isPlaying);
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById("body-main").classList.toggle("playing", isPlaying);
Â  Â  Â  Â  Â  Â  Â  Â  if(e.data === 0) playNext();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }});
Â  Â  Â  Â  setInterval(updateProgress, 1000);
Â  Â  }

Â  Â  function updatePlayIcons(isPlaying) {
Â  Â  Â  Â  const icon = isPlaying ? 'pause' : 'play';
Â  Â  Â  Â  const pIcon = document.getElementById("p-icon");
Â  Â  Â  Â  const mIcon = document.getElementById("m-p-icon");
Â  Â  Â  Â  if(pIcon) pIcon.setAttribute('data-lucide', icon);
Â  Â  Â  Â  if(mIcon) mIcon.setAttribute('data-lucide', icon);
Â  Â  Â  Â  lucide.createIcons();
Â  Â  }

Â  Â  async function init() {
Â  Â  Â  Â  lucide.createIcons();
Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  const res = await fetch("/api/config");
Â  Â  Â  Â  Â  Â  const data = await res.json();
Â  Â  Â  Â  Â  Â  apiKey = data.yt;
Â  Â  Â  Â  } catch(e) {Â 
Â  Â  Â  Â  Â  Â  // Fallback for dev
Â  Â  Â  Â  Â  Â  apiKey = "YOUR_API_KEY";Â 
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  if(localStorage.getItem('pixelFavs')) favorites = JSON.parse(localStorage.getItem('pixelFavs'));
Â  Â  Â  Â  if(localStorage.getItem('pixelUser')) {
Â  Â  Â  Â  Â  Â  currentUser = JSON.parse(localStorage.getItem('pixelUser'));
Â  Â  Â  Â  Â  Â  showApp();
Â  Â  Â  Â  }
Â  Â  }

Â  Â  // --- GOOGLE LOGIN HANDLER ---
Â  Â  function handleCredentialResponse(response) {
Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  const payload = JSON.parse(atob(response.credential.split('.')[1]));
Â  Â  Â  Â  Â  Â  currentUser = {Â 
Â  Â  Â  Â  Â  Â  Â  Â  username: payload.name,Â 
Â  Â  Â  Â  Â  Â  Â  Â  picture: payload.pictureÂ 
Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  localStorage.setItem('pixelUser', JSON.stringify(currentUser));
Â  Â  Â  Â  Â  Â  showApp();
Â  Â  Â  Â  Â  Â  showToast("Welcome " + payload.given_name + "! ðŸŒŸ");
Â  Â  Â  Â  } catch(e) {
Â  Â  Â  Â  Â  Â  showToast("Login Failed");
Â  Â  Â  Â  }
Â  Â  }

Â  Â  function guestLogin() {
Â  Â  Â  Â  currentUser = {Â 
Â  Â  Â  Â  Â  Â  username: "Elite-" + Math.floor(Math.random()*999),Â 
Â  Â  Â  Â  Â  Â  picture: "https://api.dicebear.com/7.x/bottts/svg?seed=" + Math.random()Â 
Â  Â  Â  Â  };
Â  Â  Â  Â  localStorage.setItem('pixelUser', JSON.stringify(currentUser));
Â  Â  Â  Â  showApp();
Â  Â  }

Â  Â  function showApp() {
Â  Â  Â  Â  document.getElementById("auth-screen").style.display = "none";
Â  Â  Â  Â  document.getElementById("main-header").style.display = "flex";
Â  Â  Â  Â  document.getElementById("bottom-nav").style.display = "flex";
Â  Â  Â  Â  document.getElementById("home-view").classList.add("active");
Â  Â  Â  Â  document.getElementById("user-avatar").innerHTML = `<img src="${currentUser.picture}" style="width:100%; height:100%; object-fit:cover;">`;
Â  Â  Â  Â  loadFeed();
Â  Â  }

Â  Â  // --- JAM LOGIC ---
Â  Â  function createJam() { isAdmin = true; joinProcess("ELITE-" + Math.floor(1000 + Math.random() * 9000)); }
Â  Â  function joinJam() {Â 
Â  Â  Â  Â  isAdmin = false;Â 
Â  Â  Â  Â  const code = prompt("Enter 4-Digit Jam Code:");Â 
Â  Â  Â  Â  if(code) joinProcess(code.toUpperCase());Â 
Â  Â  }
Â  Â Â 
Â  Â  function joinProcess(code) {
Â  Â  Â  Â  jamRoom = code;
Â  Â  Â  Â  socket.emit("join", { room: code, user: currentUser, isAdmin: isAdmin });
Â  Â  Â  Â Â 
Â  Â  Â  Â  document.getElementById("jam-info").style.display = "block";
Â  Â  Â  Â  document.getElementById("jam-setup").style.display = "none";
Â  Â  Â  Â  document.getElementById("active-room-text").innerText = "ROOM: " + code;
Â  Â  Â  Â  document.getElementById("room-id-tag").innerText = code;
Â  Â  Â  Â Â 
Â  Â  Â  Â  const actionBtn = document.getElementById("jam-action-btn");
Â  Â  Â  Â  if(isAdmin) {
Â  Â  Â  Â  Â  Â  actionBtn.innerText = "END JAM";
Â  Â  Â  Â  Â  Â  actionBtn.onclick = endJam;
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  actionBtn.innerText = "LEAVE";
Â  Â  Â  Â  Â  Â  actionBtn.onclick = leaveJam;
Â  Â  Â  Â  }
Â  Â  Â  Â  showToast(isAdmin ? "Elite Jam Hosted âš¡" : "Joined Jam âš¡");
Â  Â  }

Â  Â  function leaveJam() {
Â  Â  Â  Â  socket.emit("leave-jam", { room: jamRoom, user: currentUser });
Â  Â  Â  Â  resetJamUI();
Â  Â  }

Â  Â  function endJam() {
Â  Â  Â  Â  if(confirm("End jam for everyone?")) {
Â  Â  Â  Â  Â  Â  socket.emit("close-room", { room: jamRoom });
Â  Â  Â  Â  Â  Â  resetJamUI();
Â  Â  Â  Â  }
Â  Â  }

Â  Â  function resetJamUI() {
Â  Â  Â  Â  jamRoom = null; isAdmin = false;
Â  Â  Â  Â  document.getElementById("jam-info").style.display = "none";
Â  Â  Â  Â  document.getElementById("jam-setup").style.display = "flex";
Â  Â  Â  Â  document.getElementById("room-id-tag").innerText = "";
Â  Â  Â  Â  document.getElementById("jam-users-list").innerHTML = "";
Â  Â  }

Â  Â  // --- JAM SOCKET LISTENERS ---
Â  Â  socket.on("user-update", (users) => {
Â  Â  Â  Â  const list = document.getElementById("jam-users-list");
Â  Â  Â  Â  list.innerHTML = users.map(u => `
Â  Â  Â  Â  Â  Â  <div class="jam-user-badge">
Â  Â  Â  Â  Â  Â  Â  Â  <img src="${u.picture}" style="width:18px; height:18px; border-radius:50%">
Â  Â  Â  Â  Â  Â  Â  Â  <span>${u.username} ${u.isAdmin ? 'ðŸ‘‘' : ''}</span>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  `).join('');
Â  Â  });

Â  Â  socket.on("sync-play", (data) => {
Â  Â  Â  Â  if(!isAdmin) {Â 
Â  Â  Â  Â  Â  Â  playSongRaw(data);
Â  Â  Â  Â  Â  Â  showToast("Syncing with Host...");
Â  Â  Â  Â  }
Â  Â  });

Â  Â  socket.on("room-closed", () => {
Â  Â  Â  Â  showToast("Jam ended by host");
Â  Â  Â  Â  resetJamUI();
Â  Â  });

Â  Â  socket.on("error-msg", (msg) => {
Â  Â  Â  Â  showToast("âš ï¸ " + msg);
Â  Â  Â  Â  resetJamUI();
Â  Â  });

Â  Â  // --- CORE MUSIC LOGIC ---
Â  Â  function playSong(index, source = 'playlist') {
Â  Â  Â  Â  let list = (source === 'library-list') ? favorites : playlist;
Â  Â  Â  Â  if(!list[index]) return;
Â  Â  Â  Â Â 
Â  Â  Â  Â  currentIndex = index;
Â  Â  Â  Â  const s = list[index];
Â  Â  Â  Â  const songData = {
Â  Â  Â  Â  Â  Â  id: s.id?.videoId || s.id,
Â  Â  Â  Â  Â  Â  title: s.snippet?.title || s.title,
Â  Â  Â  Â  Â  Â  img: s.snippet?.thumbnails?.high?.url || s.img,
Â  Â  Â  Â  Â  Â  artist: s.snippet?.channelTitle || s.artist
Â  Â  Â  Â  };
Â  Â  Â  Â Â 
Â  Â  Â  Â  playSongRaw(songData);
Â  Â  Â  Â  if(jamRoom && isAdmin) {
Â  Â  Â  Â  Â  Â  socket.emit("jam-play", { room: jamRoom, ...songData });
Â  Â  Â  Â  }
Â  Â  }

Â  Â  function playSongRaw(data) {
Â  Â  Â  Â  if(!yt) return;
Â  Â  Â  Â  yt.loadVideoById(data.id);
Â  Â  Â  Â  document.getElementById("f-img").src = document.getElementById("m-img").src = data.img;
Â  Â  Â  Â  document.getElementById("f-title").innerText = document.getElementById("m-title").innerText = data.title;
Â  Â  Â  Â  document.getElementById("f-artist").innerText = data.artist;
Â  Â  Â  Â  document.getElementById("mini-player").style.display = "flex";
Â  Â  Â  Â  checkFavStatus(data.id);
Â  Â  Â  Â  // Reset lyrics view when song changes
Â  Â  Â  Â  toggleLyrics(false);
Â  Â  }

Â  Â  async function loadFeed() {
Â  Â  Â  Â  if(!apiKey) return;
Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  const res = await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&q=LatestEliteMusic2025&type=video&maxResults=15&key=${apiKey}`);
Â  Â  Â  Â  Â  Â  const data = await res.json();Â 
Â  Â  Â  Â  Â  Â  playlist = data.items;Â 
Â  Â  Â  Â  Â  Â  renderList(playlist, "home-feed");
Â  Â  Â  Â  } catch(e) {}
Â  Â  }

Â  Â  async function startSearch() {
Â  Â  Â  Â  const q = document.getElementById("sq").value;
Â  Â  Â  Â  if(!q || !apiKey) return;
Â  Â  Â  Â  const res = await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&q=${q}&type=video&maxResults=20&key=${apiKey}`);
Â  Â  Â  Â  const data = await res.json();Â 
Â  Â  Â  Â  playlist = data.items;Â 
Â  Â  Â  Â  renderList(playlist, "search-results");
Â  Â  }

Â  Â  function renderList(items, target) {
Â  Â  Â  Â  const container = document.getElementById(target);
Â  Â  Â  Â  if(!container) return;
Â  Â  Â  Â  container.innerHTML = items.map((v, i) => `
Â  Â  Â  Â  Â  Â  <div class="song-card" onclick="playSong(${i}, '${target}')">
Â  Â  Â  Â  Â  Â  Â  Â  <img src="${v.snippet?.thumbnails?.medium?.url || v.img}">
Â  Â  Â  Â  Â  Â  Â  Â  <div style="flex:1; overflow:hidden;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <b style="display:block; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">${v.snippet?.title || v.title}</b>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <small style="opacity:0.5;">${v.snippet?.channelTitle || v.artist}</small>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <i data-lucide="play-circle" size="20" style="opacity:0.3"></i>
Â  Â  Â  Â  Â  Â  </div>`).join('');
Â  Â  Â  Â  lucide.createIcons();
Â  Â  }

Â  Â  function togglePlay() {Â 
Â  Â  Â  Â  const s = yt.getPlayerState();Â 
Â  Â  Â  Â  s === 1 ? yt.pauseVideo() : yt.playVideo();Â 
Â  Â  }
Â  Â Â 
Â  Â  function seekSong(v) {Â 
Â  Â  Â  Â  if(yt) yt.seekTo(yt.getDuration() * (v/100), true);Â 
Â  Â  }
Â  Â Â 
Â  Â  function updateProgress() {Â 
Â  Â  Â  Â  if(yt && yt.getDuration && yt.getPlayerState() === 1) {
Â  Â  Â  Â  Â  Â  document.getElementById("seek-slider").value = (yt.getCurrentTime() / yt.getDuration()) * 100;Â 
Â  Â  Â  Â  }
Â  Â  }
Â  Â Â 
Â  Â  function switchTab(t, el) {
Â  Â  Â  Â  document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
Â  Â  Â  Â  document.querySelectorAll('.nav-link').forEach(n => n.classList.remove('active'));
Â  Â  Â  Â  document.getElementById(t+'-view').classList.add('active');Â 
Â  Â  Â  Â  el.classList.add('active');
Â  Â  Â  Â  if(t === 'library') renderList(favorites, "library-list");
Â  Â  Â  Â  lucide.createIcons();
Â  Â  }

Â  Â  function toggleFavorite() {
Â  Â  Â  Â  const s = playlist[currentIndex];
Â  Â  Â  Â  if(!s) return;
Â  Â  Â  Â  const id = s.id?.videoId || s.id;
Â  Â  Â  Â  const idx = favorites.findIndex(f => (f.id?.videoId || f.id) === id);
Â  Â  Â  Â  if(idx === -1) {
Â  Â  Â  Â  Â  Â  favorites.push({
Â  Â  Â  Â  Â  Â  Â  Â  id: id,Â 
Â  Â  Â  Â  Â  Â  Â  Â  title: s.snippet?.title || s.title,Â 
Â  Â  Â  Â  Â  Â  Â  Â  img: s.snippet?.thumbnails?.high?.url || s.img,Â 
Â  Â  Â  Â  Â  Â  Â  Â  artist: s.snippet?.channelTitle || s.artist
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  showToast("Elite Collection Added â¤ï¸");
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  favorites.splice(idx, 1);
Â  Â  Â  Â  Â  Â  showToast("Removed from Collection");
Â  Â  Â  Â  }
Â  Â  Â  Â  localStorage.setItem('pixelFavs', JSON.stringify(favorites));
Â  Â  Â  Â  checkFavStatus(id);
Â  Â  }

Â  Â  function checkFavStatus(id) {
Â  Â  Â  Â  const isFav = favorites.some(f => (f.id?.videoId || f.id) === id);
Â  Â  Â  Â  const icon = document.getElementById("fav-icon-heart");
Â  Â  Â  Â  if(icon) {
Â  Â  Â  Â  Â  Â  icon.style.color = isFav ? "var(--ios-pink)" : "#444";
Â  Â  Â  Â  Â  Â  icon.setAttribute('data-lucide', isFav ? 'heart-handshake' : 'heart');
Â  Â  Â  Â  Â  Â  lucide.createIcons();
Â  Â  Â  Â  }
Â  Â  }

Â  Â  // --- ADDED: LYRICS LOGIC ---
Â  Â  function toggleLyrics(show) {
Â  Â  Â  Â  const container = document.getElementById("lyrics-container");
Â  Â  Â  Â  container.style.display = show ? "flex" : "none";
Â  Â  Â  Â  if(show) {
Â  Â  Â  Â  Â  Â  const title = document.getElementById("f-title").innerText;
Â  Â  Â  Â  Â  Â  document.getElementById("lyrics-content").innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  <p class="lyric-line active">Now Playing:</p>
Â  Â  Â  Â  Â  Â  Â  Â  <p class="lyric-line">${title}</p>
Â  Â  Â  Â  Â  Â  Â  Â  <p class="lyric-line" style="opacity:0.2">[No Synchronized Lyrics Found]</p>
Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  }
Â  Â  }

Â  Â  function showToast(m) {Â 
Â  Â  Â  Â  const t = document.getElementById("toast");Â 
Â  Â  Â  Â  t.innerText = m;Â 
Â  Â  Â  Â  t.style.display="block";Â 
Â  Â  Â  Â  setTimeout(()=>t.style.display="none",2500);Â 
Â  Â  }

Â  Â  function togglePlayer(s) {Â 
Â  Â  Â  Â  document.getElementById("player-overlay").classList.toggle("active", s);Â 
Â  Â  }

Â  Â  function playNext() {Â 
Â  Â  Â  Â  if(currentIndex < playlist.length - 1) playSong(currentIndex + 1);Â 
Â  Â  Â  Â  else showToast("End of Playlist");
Â  Â  }

Â  Â  function playPrev() {Â 
Â  Â  Â  Â  if(currentIndex > 0) playSong(currentIndex - 1);Â 
Â  Â  }

Â  Â  function toggleProfileMenu() {Â 
Â  Â  Â  Â  const m = document.getElementById("profile-menu");Â 
Â  Â  Â  Â  m.style.display = (m.style.display === "flex") ? "none" : "flex";Â 
Â  Â  }

Â  Â  function logout() { localStorage.removeItem('pixelUser'); location.reload(); }
Â  Â  function clearStorage() { localStorage.clear(); location.reload(); }

Â  Â  init();
</script>
</body>
</html>
